version: '3'

tasks:
    setup:
        desc: Initial setup - install dependencies
        cmds:
            - npm ci
            - mkdir -p .git/hooks
            - |
                cat > .git/hooks/pre-commit <<'HOOK'
                #!/usr/bin/env bash
                set -e
                # Prefer the Taskfile CLI; fallback to npm scripts
                if command -v task >/dev/null 2>&1; then
                  task precommit
                else
                  npm run lint:fix
                  npm run format
                  npm run test:once
                fi
                HOOK
            - chmod +x .git/hooks/pre-commit

    dev:
        desc: Run in dev mode - start Vite development server
        cmds:
            - npm run dev

    test:
        desc: Run unit tests using Vitest
        cmds:
            - npm run test

    precommit:
        desc: Run pre-commit checks - lint and test
        cmds:
            - npm run lint:fix
            - npm run format
            - npm run test:once
